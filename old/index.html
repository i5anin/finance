<!DOCTYPE html>
<html lang="ru">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Финансовый отчет</title>
        <script src="http://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="http://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </head>

    <body>

        <table border="1" id="financeTable">
            <tr>
                <th>Дата</th>
                <th>Доход/Расход</th>
                <th>Пояснение</th>
                <th>Тип</th>
                <th>Рубли</th>
                <th>Доллары</th>
                <th>Золото</th>
            </tr>
            <!-- данные будут добавлены динамически -->
        </table>

        <canvas id="myChart" width="400" height="200"></canvas>

        <script>
            async function fetchFinanceData() {
                try {
                    const response = await axios.get('data.json');
                    return response.data.financeData;
                } catch (error) {
                    console.error('Ошибка при получении финансовых данных:', error);
                }
            }

            async function renderTableAndChart() {
                try {
                    const financeData = await fetchFinanceData();

                    // Захардкодим значения для доллара и золота
                    const currencyData = { dollar: 1, gold: 1 };

                    if (!financeData) {
                        console.error('Не удалось получить все необходимые данные');
                        return;  // завершить выполнение функции, если данные отсутствуют
                    }

                    const table = document.getElementById('financeTable');
                    financeData.forEach(item => {
                        const row = table.insertRow();
                        ['date', 'incomeExpense', 'description', 'type', 'rubles', 'dollars', 'gold'].forEach(key => {
                            const cell = row.insertCell();
                            cell.textContent = item[key];
                        });
                    });

                    const ctx = document.getElementById('myChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: financeData.map(item => item.date),
                            datasets: [{
                                label: 'Рубли',
                                data: financeData.map(item => item.rubles),
                                borderColor: 'blue',
                                fill: false,
                                yAxisID: 'y-axis-1',
                            }, {
                                label: 'Доллары',
                                data: financeData.map(item => item.dollars * currencyData.dollar),
                                borderColor: 'green',
                                fill: false,
                                yAxisID: 'y-axis-2',
                            }, {
                                label: 'Золото',
                                data: financeData.map(item => item.gold * currencyData.gold),
                                borderColor: 'gold',
                                fill: false,
                                yAxisID: 'y-axis-2',
                            }]
                        },
                        options: {
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Дата'
                                    }
                                },
                                'y-axis-1': {
                                    type: 'linear',
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: 'Рубли'
                                    }
                                },
                                'y-axis-2': {
                                    type: 'linear',
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: 'Доллары / Золото'
                                    },
                                    grid: {
                                        drawOnChartArea: false, // только одна сетка на графике
                                    },
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('Ошибка при рендеринге таблицы и графика:', error);
                }
            }

            renderTableAndChart();
        </script>

    </body>

</html>